!function(t){var e={};function s(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,o){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(o,r,function(e){return t[e]}.bind(null,r));return o},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=3)}([function(t,e,s){},,,function(t,e,s){"use strict";s.r(e);s(0);class o{constructor(t,e=chrome.storage.local){this.key=t,this.storage=e}saveAll(t){this.storage.set({[this.key]:t})}async readAll(){return new Promise(t=>{this.storage.get(this.key,e=>{t(e[this.key])})})}}class r{constructor(t){this.storage=t}async initState(){this.state=await this.storage.readAll()||{commentHidePersistor:{}}}save(){this.storage.saveAll(this.state)}}function n(){const t=document.createElement("script");t.textContent="setTimeout(() => wykop.bindLazy(), 1000)",(document.head||document.documentElement).appendChild(t),t.remove()}function i(t){const e=t.getBoundingClientRect(),s=window.innerHeight||document.documentElement.clientHeight,o=e.bottom>0&&e.bottom<s,r=e.top<s&&e.bottom>0;return o||r}function a(t=document){return t.querySelectorAll("#itemsStream > .iC:not(.link)")}function c(t=document){return t.querySelectorAll("#itemsStream > .iC")}function l(){return document.querySelector("#itemsStream")}class d{constructor(t){this.moduleName=t}async init(){}}class u extends d{constructor(){super("CommentsHiderModule");const t=new o(u.STORAGE_KEY);this.statePersistor=new r(t),this.articleId=this.getArticleId()}async init(){await this.statePersistor.initState(),this.addCommentButtons()}addCommentButtons(){for(const t of a()){if(t.classList.contains("commen-hider-applied"))continue;const e=this.createHideButton(t);t.classList.add("comment-hider-applied");const s=t.querySelector(".dC").dataset.id;this.isCommentHidden(this.articleId,s)?this.hideComments(e,t,this.articleId,s):this.showComments(e,t,this.articleId,s),e.addEventListener("click",()=>{this.isCommentHidden(this.articleId,s)?this.showComments(e,t,this.articleId,s):(this.hideComments(e,t,this.articleId,s),n())})}n()}getArticleId(){return location.pathname.startsWith("/link")?location.pathname.split("/")[2]:"mikroblog"}createHideButton(t){const e=document.createElement("a");return e.setAttribute("href","javascript:void(0)"),e.classList.add("comment-expand"),t.prepend(e),e}hideComments(t,e,s,o){t.textContent="[+]",e.classList.add("collapsed"),this.statePersistor.state.commentHidePersistor[s]=this.statePersistor.state.commentHidePersistor[s]||{collapsedThings:{}},this.statePersistor.state.commentHidePersistor[s].lastUpdate=(new Date).getTime(),this.statePersistor.state.commentHidePersistor[s].collapsedThings[o]=!0,this.statePersistor.save(),i(e)||function(t){t.scrollIntoView(),window.scrollBy(0,-50)}(e)}showComments(t,e,s,o){t.textContent="[-]",e.classList.remove("collapsed"),this.statePersistor.state.commentHidePersistor[s]=this.statePersistor.state.commentHidePersistor[s]||{collapsedThings:{}},this.statePersistor.state.commentHidePersistor[s].lastUpdate=(new Date).getTime(),delete this.statePersistor.state.commentHidePersistor[s].collapsedThings[o],this.statePersistor.save()}isCommentHidden(t,e){return this.statePersistor.state.commentHidePersistor[t]&&this.statePersistor.state.commentHidePersistor[t].collapsedThings&&this.statePersistor.state.commentHidePersistor[t].collapsedThings[e]}}u.STORAGE_KEY="comments-state";class h{constructor(t,e){this.basePath=t,this.page={isLast:this.isLastPage(document),isLoading:!1,currentPage:e||1}}async loadNextPage(){this.page.isLoading=!0;const t=this.page.currentPage+1;try{const e=await this.getNextPageItems(t),s=c(e);l().append(...s),this.page.currentPage=t,this.page.isLast=this.isLastPage(e),n(),console.log(`Loading page ${t}: OK`)}catch(e){throw console.warn(`Loading page ${t} FAILED`,e),e}finally{this.page.isLoading=!1}}async getNextPageItems(t){const e=this.getPageUrl(t);console.log(e);const s=await fetch(e),o=await s.text();return(new DOMParser).parseFromString(o,"text/html")}getPageUrl(t){return`${location.origin}${this.basePath}strona/${t}/`}isLastPage(t){const e=function(t=document){return t.querySelector(".pager")}(t);if(!e)return!0;const s=e.querySelector("p").children;return"nastÄ™pna"!==s[s.length-1].textContent}}const m=(()=>{const t=new u,e=new class extends d{constructor(){super("ChildrenCounterModule")}async init(){for(const t of a())t.classList.contains("children-counter-applied")||(t.classList.add("children-counter-applied"),this.createChildrenCounter(t))}createChildrenCounter(t){const e=document.createElement("span");e.classList.add("child-counter");const s=t.querySelector(".sub .more a");let o;if(s)try{o=Number(/\((\d+)\)/g.exec(s.textContent)[1])+2}catch(e){o=t.querySelectorAll(".sub > li").length}else o=t.querySelectorAll(".sub > li").length;return e.textContent=`(${o} dzieci)`,t.querySelector(".author .affect").appendChild(e),e}},s=new class extends d{constructor(){super("FooterRemoverModule")}async init(){this.removeFooter()}removeFooter(){document.querySelector("#footer").remove(),document.querySelector("#site").classList.add("remove-footer")}};new class extends d{constructor(t,e){super("InfiniteScrollModule"),this.commentsHiderModule=t,this.childrenCounterModule=e}async init(){const t=this.parseCurrentUrl();console.log("UrlData",t),this.pageController=new h(t.basePath,t.currentPage),this.startOnScrollListener()}parseCurrentUrl(){const t=location.pathname,e=/^(.*)\/strona\/(\d+).*$/.exec(t);return e?{basePath:e[1]||"/",currentPage:Number(e[2])}:{basePath:t,currentPage:1}}startOnScrollListener(){let t=this.getLastItem();if(this.pageController.page.isLast)return void console.log("The first page is also the last. Infinite scoll is disabled.");const e=async()=>{!this.pageController.page.isLoading&&i(t)&&(await this.pageController.loadNextPage(),this.addPageBar(t,this.pageController.page.currentPage),this.updateUrl(this.pageController.page.currentPage),this.commentsHiderModule.addCommentButtons(),this.childrenCounterModule.init(),t=this.getLastItem(),this.pageController.page.isLast&&(console.log(`Page ${this.pageController.page.currentPage} is the last one. Infinite scroll is disabled`),window.removeEventListener("scroll",e)))};window.addEventListener("scroll",e)}getLastItem(){for(const t of[...c()].reverse())if(!this.isAdd(t))return t}isAdd(t){return t.querySelector('a[href="https://www.wykop.pl/reklama/"]')}addPageBar(t,e){const s=document.createElement("li");s.classList.add("next-page-bar"),s.textContent=`Strona ${e}`,l().insertBefore(s,t.nextSibling)}updateUrl(t){history.replaceState(null,null,this.pageController.getPageUrl(t))}}(t,e);return[t,e,s]})();!async function(){console.log("doo");let t=0;for(const e of m){const s=e.moduleName;try{await e.init(),console.log(`Loading Module ${s}: OK`),t++}catch(t){console.error(`Module ${s} initialization FAILED`,t)}}console.log(`--- Loaded Successfully: ${t}. Fails: ${m.length-t} ---`)}()}]);