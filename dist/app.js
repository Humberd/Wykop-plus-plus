!function(t){var e={};function r(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(n,s,function(e){return t[e]}.bind(null,s));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=7)}([function(t,e,r){},function(t,e,r){},function(t,e,r){},function(t,e,r){},,,,function(t,e,r){"use strict";r.r(e);class n{constructor(t,e=chrome.storage.local){this.key=t,this.storage=e}saveAll(t){this.storage.set({[this.key]:t})}async readAll(){return new Promise(t=>{this.storage.get(this.key,e=>{t(e[this.key])})})}}class s{constructor(t){this.storage=t}async initState(){this.state=await this.storage.readAll()||{commentHidePersistor:{}}}save(){this.storage.saveAll(this.state)}}function o(){const t=document.createElement("script");t.textContent="setTimeout(() => wykop.bindLazy(), 1000)",(document.head||document.documentElement).appendChild(t),t.remove()}function i(t){console.log("Scrolling to",t),t.scrollIntoView(),window.scrollBy(0,-50)}function c(t){const e=t.getBoundingClientRect(),r=window.innerHeight||document.documentElement.clientHeight,n=e.bottom>0&&e.bottom<r,s=e.top<r&&e.bottom>0;return n||s}function a(t=document){return t.querySelectorAll("#itemsStream > .iC:not(.link)")}function u(t=document){return t.querySelectorAll("#itemsStream > .iC")}function l(){return document.querySelector("#itemsStream")}function h(t=document){return t.querySelector(".pager")}class p{constructor(t){this.moduleName=t}async init(){}isTurnedOn(){return!0}}r(0);class d extends p{constructor(t){super(),this.appEvents=t;const e=new n(d.STORAGE_KEY);this.statePersistor=new s(e),this.articleId=this.getArticleId()}async init(){await this.statePersistor.initState(),this.listenForEvents()}listenForEvents(){this.appEvents.onItemsLoaded.asObservable().subscribe(t=>this.addCommentButtons(t.isInitial))}addCommentButtons(t){const e=a();let r,n=0;for(const t of e){if(t.querySelector(`.${d.ELEMENT_CLASS}`))continue;const e=this.createHideButton(t),s=t.querySelector(".dC").dataset.id;this.isCommentHidden(this.articleId,s)?this.hideComments(e,t,this.articleId,s):(this.showComments(e,t,this.articleId,s),r||(r=t)),e.addEventListener("click",()=>{this.isCommentHidden(this.articleId,s)?this.showComments(e,t,this.articleId,s):(this.hideComments(e,t,this.articleId,s),this.appEvents.onCommentHid.next(),c(t)||i(t),o())}),n++}console.log(`Added ${n}/${e.length} comments hide buttons`),o(),t&&setTimeout(()=>{window.scrollTo(0,0)},500)}getArticleId(){return location.pathname.startsWith("/link")?location.pathname.split("/")[2]:"mikroblog"}createHideButton(t){const e=document.createElement("a");return e.setAttribute("href","javascript:void(0)"),e.classList.add("comment-expand"),e.classList.add(d.ELEMENT_CLASS),t.prepend(e),e}hideComments(t,e,r,n){t.textContent="[+]",e.classList.add("collapsed"),this.statePersistor.state.commentHidePersistor[r]=this.statePersistor.state.commentHidePersistor[r]||{collapsedThings:{}},this.statePersistor.state.commentHidePersistor[r].lastUpdate=(new Date).getTime(),this.statePersistor.state.commentHidePersistor[r].collapsedThings[n]=!0,this.statePersistor.save()}showComments(t,e,r,n){t.textContent="[-]",e.classList.remove("collapsed"),this.statePersistor.state.commentHidePersistor[r]=this.statePersistor.state.commentHidePersistor[r]||{collapsedThings:{}},this.statePersistor.state.commentHidePersistor[r].lastUpdate=(new Date).getTime(),delete this.statePersistor.state.commentHidePersistor[r].collapsedThings[n],this.statePersistor.save()}isCommentHidden(t,e){return this.statePersistor.state.commentHidePersistor[t]&&this.statePersistor.state.commentHidePersistor[t].collapsedThings&&this.statePersistor.state.commentHidePersistor[t].collapsedThings[e]}}d.MODULE_NAME="CommentsHiderModule",d.STORAGE_KEY="comments-state",d.ELEMENT_CLASS="x-comment-hider";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var f=function(t,e){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function b(t,e){function r(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function y(t){return"function"==typeof t}var m=!1,g={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;m=t},get useDeprecatedSynchronousErrorHandling(){return m}};function E(t){setTimeout(function(){throw t})}var _={closed:!0,next:function(t){},error:function(t){if(g.useDeprecatedSynchronousErrorHandling)throw t;E(t)},complete:function(){}},v=Array.isArray||function(t){return t&&"number"==typeof t.length};function w(t){return null!=t&&"object"==typeof t}var S,P={e:{}};function x(){try{return S.apply(this,arguments)}catch(t){return P.e=t,P}}function L(t){return S=t,x}function C(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}C.prototype=Object.create(Error.prototype);var T=C,O=function(){function t(t){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var t,e=!1;if(!this.closed){var r=this._parent,n=this._parents,s=this._unsubscribe,o=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var i=-1,c=n?n.length:0;r;)r.remove(this),r=++i<c&&n[i]||null;if(y(s))L(s).call(this)===P&&(e=!0,t=t||(P.e instanceof T?M(P.e.errors):[P.e]));if(v(o))for(i=-1,c=o.length;++i<c;){var a=o[i];if(w(a))if(L(a.unsubscribe).call(a)===P){e=!0,t=t||[];var u=P.e;u instanceof T?t=t.concat(M(u.errors)):t.push(u)}}if(e)throw new T(t)}},t.prototype.add=function(e){if(!e||e===t.EMPTY)return t.EMPTY;if(e===this)return this;var r=e;switch(typeof e){case"function":r=new t(e);case"object":if(r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if("function"!=typeof r._addParent){var n=r;(r=new t)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(r),r._addParent(this),r},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}},t.prototype._addParent=function(t){var e=this._parent,r=this._parents;e&&e!==t?r?-1===r.indexOf(t)&&r.push(t):this._parents=[t]:this._parent=t},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function M(t){return t.reduce(function(t,e){return t.concat(e instanceof T?e.errors:e)},[])}var H="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),A=function(t){function e(r,n,s){var o=t.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,o._parentSubscription=null,arguments.length){case 0:o.destination=_;break;case 1:if(!r){o.destination=_;break}if("object"==typeof r){r instanceof e?(o.syncErrorThrowable=r.syncErrorThrowable,o.destination=r,r.add(o)):(o.syncErrorThrowable=!0,o.destination=new I(o,r));break}default:o.syncErrorThrowable=!0,o.destination=new I(o,r,n,s)}return o}return b(e,t),e.prototype[H]=function(){return this},e.create=function(t,r,n){var s=new e(t,r,n);return s.syncErrorThrowable=!1,s},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parent,e=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=e,this._parentSubscription=null,this},e}(O),I=function(t){function e(e,r,n,s){var o,i=t.call(this)||this;i._parentSubscriber=e;var c=i;return y(r)?o=r:r&&(o=r.next,n=r.error,s=r.complete,r!==_&&(y((c=Object.create(r)).unsubscribe)&&i.add(c.unsubscribe.bind(c)),c.unsubscribe=i.unsubscribe.bind(i))),i._context=c,i._next=o,i._error=n,i._complete=s,i}return b(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;g.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,r=g.useDeprecatedSynchronousErrorHandling;if(this._error)r&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):E(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;E(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var r=function(){return t._complete.call(t._context)};g.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),g.useDeprecatedSynchronousErrorHandling)throw t;E(t)}},e.prototype.__tryOrSetError=function(t,e,r){if(!g.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(e){return g.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(E(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(A);var D="function"==typeof Symbol&&Symbol.observable||"@@observable";function j(){}function N(t){return t?1===t.length?t[0]:function(e){return t.reduce(function(t,e){return e(t)},e)}:j}var $=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n=this.operator,s=function(t,e,r){if(t){if(t instanceof A)return t;if(t[H])return t[H]()}return t||e||r?new A(t,e,r):new A(_)}(t,e,r);if(n?n.call(s,this.source):s.add(this.source||g.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),g.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){g.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),!function(t){for(;t;){var e=t,r=e.closed,n=e.destination,s=e.isStopped;if(r||s)return!1;t=n&&n instanceof A?n:null}return!0}(t)?console.warn(e):t.error(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=U(e))(function(e,n){var s;s=r.subscribe(function(e){try{t(e)}catch(t){n(t),s&&s.unsubscribe()}},n,e)})},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[D]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:N(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=U(t))(function(t,r){var n;e.subscribe(function(t){return n=t},function(t){return r(t)},function(){return t(n)})})},t.create=function(e){return new t(e)},t}();function U(t){if(t||(t=g.Promise||Promise),!t)throw new Error("no Promise impl found");return t}function k(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}k.prototype=Object.create(Error.prototype);var q=k,F=function(t){function e(e,r){var n=t.call(this)||this;return n.subject=e,n.subscriber=r,n.closed=!1,n}return b(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var r=e.indexOf(this.subscriber);-1!==r&&e.splice(r,1)}}},e}(O),B=function(t){function e(e){var r=t.call(this,e)||this;return r.destination=e,r}return b(e,t),e}(A),Y=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return b(e,t),e.prototype[H]=function(){return new B(this)},e.prototype.lift=function(t){var e=new V(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new q;if(!this.isStopped)for(var e=this.observers,r=e.length,n=e.slice(),s=0;s<r;s++)n[s].next(t)},e.prototype.error=function(t){if(this.closed)throw new q;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,r=e.length,n=e.slice(),s=0;s<r;s++)n[s].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new q;this.isStopped=!0;for(var t=this.observers,e=t.length,r=t.slice(),n=0;n<e;n++)r[n].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new q;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new q;return this.hasError?(t.error(this.thrownError),O.EMPTY):this.isStopped?(t.complete(),O.EMPTY):(this.observers.push(t),new F(this,t))},e.prototype.asObservable=function(){var t=new $;return t.source=this,t},e.create=function(t,e){return new V(t,e)},e}($),V=function(t){function e(e,r){var n=t.call(this)||this;return n.destination=e,n.source=r,n}return b(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):O.EMPTY},e}(Y);r(1);class R extends p{constructor(t){super(),this.appEvents=t}async init(){this.listenForEvents()}listenForEvents(){this.appEvents.onItemsLoaded.asObservable().subscribe(()=>this.addChildrenCounters())}addChildrenCounters(){const t=a();let e=0;for(const r of t)r.querySelector(`.${R.ELEMENT_CLASS}`)||(this.createChildrenCounter(r),e++);console.log(`Added ${e}/${t.length} children counters`)}createChildrenCounter(t){const e=document.createElement("span");e.classList.add("child-counter"),e.classList.add(R.ELEMENT_CLASS);const r=t.querySelector(".sub .more a");let n;if(r)try{n=Number(/\((\d+)\)/g.exec(r.textContent)[1])+2}catch(e){n=t.querySelectorAll(".sub > li").length}else n=t.querySelectorAll(".sub > li").length;return e.textContent=`(${n} dzieci)`,t.querySelector(".author .affect").appendChild(e),e}}R.MODULE_NAME="ChildrenCounterModule",R.ELEMENT_CLASS="x-children-counter";r(2);class z extends p{constructor(t){super(),this.appEvents=t}async init(){this.removeFooter()}removeFooter(){document.querySelector("#footer").remove(),document.querySelector("#site").classList.add("remove-footer")}}z.MODULE_NAME="FooterRemoverModule";class K{constructor(t,e){this.basePath=t,t.endsWith("/")||(this.basePath+="/"),this.page={isLast:this.isLastPage(document),isLoading:!1,currentPage:e||1}}async loadNextPage(){this.page.isLoading=!0;const t=this.page.currentPage+1;try{const e=await this.getNextPageItems(t),r=u(e);return l().append(...r),this.page.currentPage=t,this.page.isLast=this.isLastPage(e),o(),console.log(`Loading page ${t}: OK`),r}catch(e){throw console.warn(`Loading page ${t} FAILED`,e),e}finally{this.page.isLoading=!1}}async getNextPageItems(t){const e=this.getPageUrl(t);console.log(e);const r=await fetch(e),n=await r.text();return(new DOMParser).parseFromString(n,"text/html")}getPageUrl(t){return`${location.origin}${this.basePath}strona/${t}/`}isLastPage(t){const e=h(t);if(!e)return!0;const r=e.querySelector("p").children;return"następna"!==r[r.length-1].textContent}}r(3);class G extends p{constructor(t){super(),this.appEvents=t}async init(){const t=this.getPageInfo();this.pageController=new K(t.basePath,t.currentPage),this.startOnScrollListener()}getPageInfo(){const t=location.pathname,e=/^(.*)\/strona\/(\d+).*$/.exec(t);return e?{basePath:e[1]||"/",currentPage:Number(e[2])}:{basePath:t,currentPage:1}}startOnScrollListener(){const t=h();if(this.pageController.page.isLast)return void console.log("The first page is also the last. Infinite scoll is disabled.");const e=async()=>{if(!this.pageController.page.isLoading&&c(t)){const t=this.getLastItem();await this.pageController.loadNextPage(),this.addPageBar(t,this.pageController.page.currentPage),this.appEvents.onItemsLoaded.next({isInitial:!1}),this.pageController.page.isLast&&(console.log(`Page ${this.pageController.page.currentPage} is the last one. Infinite scroll is disabled`),window.removeEventListener("scroll",e))}};window.addEventListener("scroll",e),this.appEvents.onCommentHid.asObservable().subscribe(e)}getLastItem(){const t=u();return t[t.length-1]}addPageBar(t,e){const r=document.createElement("li");r.classList.add("next-page-bar"),r.textContent=`Strona ${e}`,l().insertBefore(r,t.nextSibling)}}async function W(t,e){return new t(e).init()}G.MODULE_NAME="InfiniteScrollModule",async function(){const t=new class{constructor(){this.onItemsLoaded=new Y,this.onCommentHid=new Y}};await async function(t,e){let r=0;for(const n of e)try{await W(n,t),r++,console.log(`Module ${n.MODULE_NAME}: OK`)}catch(t){console.error(`Module ${n.MODULE_NAME}: initialization FAILED`,t)}console.log(`--- Loaded ${r}/${e.length} modules ---`)}(t,[d,R,z,G]),await async function(t){t.onItemsLoaded.next({isInitial:!0})}(t)}()}]);